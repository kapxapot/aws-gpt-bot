import { Composer } from "telegraf";
import { WizardScene } from "telegraf/scenes";
import { BotContext } from "../botContext";
import { clearInlineKeyboard, inlineKeyboard, reply, replyWithKeyboard } from "../../lib/telegram";
import { commands, messages, scenes } from "../../lib/constants";
import { addOtherCommandHandlers, dunnoHandler, kickHandler } from "../handlers";

function makeStepHandler(text: string, first: boolean, last: boolean) {
  const stepHandler = new Composer<BotContext>();

  const nextAction = "next";
  const exitAction = "exit";

  const keyboard = inlineKeyboard(
    ["–î–∞–ª—å—à–µ", nextAction],
    ["–ó–∞–∫–æ–Ω—á–∏—Ç—å", exitAction]
  );

  stepHandler.action(nextAction, async (ctx) => {
    await clearInlineKeyboard(ctx);

    if (last) {
      await reply(ctx, text);
      await ctx.scene.leave();
    } else {
      await replyWithKeyboard(ctx, keyboard, text);
      ctx.wizard.next();
    }
  });

  stepHandler.action(exitAction, async (ctx) => {
    await clearInlineKeyboard(ctx);
    await reply(ctx, messages.backToDialog)
    await ctx.scene.leave();
  });

  if (first) {
    stepHandler.use(async (ctx) => {
      await replyWithKeyboard(ctx, keyboard, text);
      ctx.wizard.next();
    });
  } else {
    addOtherCommandHandlers(stepHandler, commands.tutorial);

    stepHandler.use(kickHandler);
    stepHandler.use(dunnoHandler);
  }

  return stepHandler;
}

const steps = [
`<b>–í —á–µ–º —Å—É—Ç—å ChatGPT?</b>

ChatGPT ‚Äî —ç—Ç–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –Ω–µ–π—Ä–æ–Ω–Ω–∞—è —Å–µ—Ç—å, —Å–ø–æ—Å–æ–±–Ω–∞—è –ø–æ–Ω–∏–º–∞—Ç—å —Ç–µ–∫—Å—Ç, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥–∏–∞–ª–æ–≥ –∏ –∏ –ø–æ–º–æ–≥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏—è—Ö –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.

ChatGPT –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, –∞ –∏–º–∏—Ç–∏—Ä—É–µ—Ç –º—ã—à–ª–µ–Ω–∏–µ. –ê–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª —É–¥–æ–±–µ–Ω –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª –≤–æ–ø—Ä–æ—Å—É.`,
`<b>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ ChatGPT</b>

üìå –ù–µ –ø–æ–∏—Å–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞.
–ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—É—á–∞–ª—Å—è –Ω–∞ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–æ 2021 –≥–æ–¥–∞ –∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç –≤–∞–º –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ —Å–∞–º—ã–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è.

üìå –ù–µ –≤—Å–µ–≥–¥–∞ –≥–æ–≤–æ—Ä–∏—Ç –ø—Ä–∞–≤–¥—É.
–ê–ª–≥–æ—Ä–∏—Ç–º –º–æ–∂–µ—Ç –æ—à–∏–±–∞—Ç—å—Å—è, –µ—Å–ª–∏ –µ–º—É –±—ã–ª–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –Ω–µ—Ç–æ—á–Ω–∞—è –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.

üìå –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
–ê–ª–≥–æ—Ä–∏—Ç–º –º–æ–∂–µ—Ç –≤—ã–¥–∞–≤–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∏–∑-–∑–∞ –Ω–µ—á–µ—Ç–∫–æ–π —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –≤–æ–ø—Ä–æ—Å–∞ –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

‚ùóÔ∏è –ü–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ –Ω–∞—É—á–∏—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –±–æ—Ç–∞. 
–ò —Ç–æ–≥–¥–∞ –æ–Ω —Å—Ç–∞–Ω–µ—Ç –¥–ª—è –≤–∞—Å –ø–æ–ª–µ–∑–Ω—ã–º –ø–æ–º–æ—â–Ω–∏–∫–æ–º –≤ —Ç–µ—Ö –∑–∞–¥–∞—á–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Ä–µ—à–∞–µ—Ç–µ.`,
`<b>–ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º</b>

1. –ó–∞–¥–∞–≤–∞–π—Ç–µ –±–æ—Ç—É —Ä–æ–ª—å.

–ù–∞–ø—Ä–∏–º–µ—Ä:
¬´–Ø —Ö–æ—á—É, —á—Ç–æ–±—ã —Ç—ã –≤—ã—Å—Ç—É–ø–∏–ª –≤ —Ä–æ–ª–∏ –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥–∞¬ª.
¬´–û—Ç–≤–µ—á–∞–π, –∫–∞–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂ (–∏–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞) –∏–∑ —Ñ–∏–ª—å–º–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞)¬ª.

2. –£—Ç–æ—á–Ω—è–π—Ç–µ.

–ß–µ–º –±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π ‚Äî —Ç–µ–º –±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –±—É–¥–µ—Ç –æ—Ç–≤–µ—Ç.

3. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ.

–ù–∞–ø—Ä–∏–º–µ—Ä:
¬´–ü—Ä–µ–¥–ª–æ–∂–∏ 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏¬ª.
¬´–ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –Ω–µ –±–æ–ª–µ–µ 10 —Å–ª–æ–≤¬ª.`,
`4. –ó–∞–¥–∞–≤–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –≤ –∫–æ—Ç–æ—Ä–æ–π —Ö–æ—Ç–∏—Ç–µ –≤–∏–¥–µ—Ç—å –æ—Ç–≤–µ—Ç.

–ù–∞–ø—Ä–∏–º–µ—Ä:
¬´–°–¥–µ–ª–∞–π –ø–æ—à–∞–≥–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –∏ —Ä–∞–∑–±–µ–π –∑–∞–¥–∞—á–∏ –Ω–∞ —ç—Ç–∞–ø—ã —Å –ø–æ–¥–∑–∞–¥–∞—á–∞–º–∏¬ª.

5. –ó–∞–¥–∞–≤–∞–π—Ç–µ –ø—Ä–∏–º–µ—Ä/—Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è.

–ù–∞–ø—Ä–∏–º–µ—Ä:
¬´–ü–µ—Ä–µ–ø–∏—à–∏ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –≤ —Ç–∞–∫–æ–º —Å—Ç–∏–ª–µ –∫–∞–∫ —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ¬ª.
¬´–ù–∞–ø–∏—à–∏ –æ—Ç–≤–µ—Ç –≤ —Å—Ç–∏–ª–µ –ø–∏—Å—å–º–∞: —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π / –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π / —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π / —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π / —é–º–æ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π¬ª.

6. –ù–µ –¥–µ–ª–∞–π—Ç–µ –æ—Ç—Å—ã–ª–∫–∏ –∫–æ –≤–Ω–µ—à–Ω–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–π—Ç), —Ç–∞–∫ –∫–∞–∫ ChatGPT –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –µ–º—É –¥–∞–µ—Ç—Å—è.`,
`<b>–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞</b>

–í –±–æ—Ç–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã 3 —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã —Å ChatGPT:

1. <b>–°–≤–æ–±–æ–¥–Ω—ã–π –¥–∏–∞–ª–æ–≥</b> ‚Äî –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤. –ü—Ä–∏ —ç—Ç–æ–º ChatGPT –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 3-—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. –†–µ–∂–∏–º –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∞ ¬´–≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç¬ª.

–ù–∞–ø—Ä–∏–º–µ—Ä:
¬´–ü—Ä–æ—á–∏—Ç–∞–π –∏ –ø–µ—Ä–µ—Å–∫–∞–∂–∏ –≤ 3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö —Å—É—Ç—å —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–µ–∫—Å—Ç–∞¬ª.
¬´–†–∞—Å—Å–∫–∞–∂–∏ –∫–∞–∫ –Ω–∞—É—á–∏—Ç—å—Å—è —Ä–∞—Å—Å—Ç–∞–≤–ª—è—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã¬ª.
¬´–ü—Ä–∏–¥—É–º–∞–π 10 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏, –∑–∞–Ω–∏–º–∞—é—â–µ–π—Å—è –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ–º –¥–µ—Ç—Å–∫–∏—Ö –∏–≥—Ä—É—à–µ–∫ –∏–∑ –¥–µ—Ä–µ–≤–∞¬ª.`,
`2. <b>–†–æ–ª—å</b> ‚Äî –æ–±—â–µ–Ω–∏–µ —Å –±–æ—Ç–æ–º –≤ —Ä–æ–ª–∏ –ö–æ—É—á–∞, –ü—Å–∏—Ö–æ–ª–æ–≥–∞, –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∏–¥–µ–π. –í —Ä–∞–º–∫–∞—Ö —Ä–æ–ª–∏ –∏—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –∏ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –∫ –¥–∏–∞–ª–æ–≥—É –≤—ã –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç–µ —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å.

3. <b>–°–≤–æ–π –ø—Ä–æ–º—Ç</b> ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é ChatGPT –±—É–¥–µ—Ç —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤ –ø–∞–º—è—Ç–∏ –∏ —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ –æ—Ç–≤–µ—Ç–∞—Ö –≤—Å–µ –≤—Ä–µ–º—è, –ø–æ–∫–∞ –≤—ã –±—É–¥–µ—Ç–µ —Å –Ω–∏–º –æ–±—â–∞—Ç—å—Å—è.

–ù–∞–ø—Ä–∏–º–µ—Ä:
¬´–í–µ–¥–∏ —Å–µ–±—è –∫–∞–∫ —É—á–∏—Ç–µ–ª—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞. –Ø –±—É–¥—É –ø–∏—Å–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –∞ —Ç—ã –∏—Å–ø—Ä–∞–≤–ª—è–π –æ—à–∏–±–∫–∏ –∏ –≥–æ–≤–æ—Ä–∏ —á—Ç–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º¬ª.`,
`<b>–¢–∞—Ä–∏—Ñ—ã</b>

–í –Ω–∞—á–∞–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞ –≤–∞–º –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–∞—Ä–∏—Ñ <b>¬´–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π¬ª</b> —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –¥–æ 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å—É—Ç–∫–∏.

–ï—Å–ª–∏ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±–æ–ª—å—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –æ–¥–Ω–∏–º –∏–∑ –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ (–ø—É–Ω–∫—Ç –º–µ–Ω—é ¬´–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É¬ª /${commands.premium})`,
`<b>–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞</b>

–ú–∏—Å—Å–∏—è GPToid ‚Äî –ø–æ–º–æ—á—å –≤–∞–º –≤ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–º –æ—Å–≤–æ–µ–Ω–∏–∏ ChatGPT.

–ë–æ—Ç –∏ –æ–±—É—á–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç –≤–∞—Å –≤ —ç—Ç–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ.

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ä–µ—à–µ–Ω–∏—é –≤–∞—à–∏—Ö –∑–∞–¥–∞—á —Å –ø–æ–º–æ—â—å—é –±–æ—Ç–∞ ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ @gptoid_support.`,
`<b>–û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</b>

üî• –í—ã –º–æ–ª–æ–¥–µ—Ü, —á—Ç–æ –¥–æ—á–∏—Ç–∞–ª–∏ –¥–æ –∫–æ–Ω—Ü–∞! üî•

–ü—Ä–æ–±—É–π—Ç–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –±–æ—Ç–æ–º —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —Ç–µ—Ö –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ —É –≤–∞—Å –µ—Å—Ç—å.

–í—ã–±–∏—Ä–∞–π—Ç–µ –æ–¥–∏–Ω –∏–∑ —Ä–µ–∂–∏–º–æ–≤ –∏ –Ω–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å –±–æ—Ç—É —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å! üìù`
];

export const tutorialScene = new WizardScene<BotContext>(
  scenes.tutorial,
  ...steps.map((step, index) => makeStepHandler(step, index === 0, index === steps.length - 1)),
  async (ctx) => await ctx.scene.leave()
);
